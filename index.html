<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutu Prompt</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <link rel="apple-touch-icon" href="icons/icon-512.png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f8f9fa; padding-bottom: 80px; }
        .result-box { background: #e9ecef; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9rem; min-height: 100px; }
        .fab-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
        .app-header { background: #fff; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
    
    <script src="presets.js"></script>
</head>
<body>

<div class="app-header sticky-top">
    <h5 class="m-0 fw-bold">ğŸŒ TutuPrompt Builder</h5>
</div>

<div class="container">
    <div class="alert alert-info shadow-sm small mt-3" role="alert">
        <span class="visually-hidden">PWA å®‰è£…æç¤ºï¼š</span>ğŸ“² æ”¯æŒç¦»çº¿ä¸ä¸»å±å®‰è£…ï¼šåœ¨æµè§ˆå™¨èœå•ä¸­é€‰æ‹©ã€Œæ·»åŠ åˆ°ä¸»å±å¹•ã€ï¼Œå³å¯å°† TutuPrompt ä½œä¸º PWA å®‰è£…ã€‚
    </div>
    <div class="mb-3">
        <label class="form-label text-secondary small">é£æ ¼æ¨¡æ¿ (Preset)</label>
        <select id="presetSelect" class="form-select shadow-sm" onchange="generate()">
            <option value="none">-- çº¯å‡€æ¨¡å¼ (ä¸ä½¿ç”¨æ¨¡æ¿) --</option>
            </select>
    </div>

    <div class="mb-3">
        <label class="form-label text-secondary small">ç”»é¢æè¿° (Subject/Action)</label>
        <textarea id="userInput" class="form-control shadow-sm" rows="3" placeholder="ä¾‹ï¼šä¸€ä¸ªç¥ç§˜çš„å¥³å­©åœ¨å“¥ç‰¹å¼æ•™å ‚é‡Œ..." oninput="generate()"></textarea>
    </div>

    <div class="card mb-3 border-0 shadow-sm">
        <div class="card-body py-2">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="qualityToggle" checked onchange="generate()">
                <label class="form-check-label small">TutuBanana ç”»è´¨å¢å¼º (8K, UE5, PBR)</label>
            </div>
            <div class="form-check form-switch mt-2">
                <input class="form-check-input" type="checkbox" id="arToggle" checked onchange="generate()">
                <label class="form-check-label small">æ·»åŠ æ¯”ä¾‹å‚æ•° (--ar 16:9)</label>
            </div>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label text-secondary small">ç”Ÿæˆç»“æœ (Preview)</label>
        <div id="finalOutput" class="result-box text-break">ç­‰å¾…è¾“å…¥...</div>
    </div>
</div>

<div class="fab-container">
    <button class="btn btn-primary rounded-pill px-4 py-2 shadow-lg fw-bold" onclick="copyPrompt()">
        ğŸ“‹ å¤åˆ¶å¹¶æ‰“å¼€ Gemini
    </button>
</div>

<script>
    // TutuBanana æ ¸å¿ƒç”»è´¨è¯ (Hardcoded Logic)
    const QUALITY_TAGS = ", (masterpiece:1.2), best quality, 8k resolution, Unreal Engine 5 rendering, Ray tracing, Physically-based rendering (PBR), detailed textures, cinematic lighting";

    // åˆå§‹åŒ–åŠ è½½
    window.onload = function() {
        // 1. æ³¨å†Œ Service Worker (PWA)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }

        // 2. æ¸²æŸ“æ¨¡æ¿åˆ—è¡¨
        const select = document.getElementById('presetSelect');
        // æŒ‰åˆ†ç±»åˆ†ç»„æ¸²æŸ“ (ç®€å•å®ç°)
        PRESETS_DB.forEach((p, index) => {
            let option = document.createElement('option');
            option.value = index;
            option.text = `[${p.category}] ${p.name}`;
            select.add(option);
        });
    };

    // æ ¸å¿ƒæ‹¼æ¥é€»è¾‘
    function generate() {
        let text = document.getElementById('userInput').value.trim();
        let presetIdx = document.getElementById('presetSelect').value;
        let useQuality = document.getElementById('qualityToggle').checked;
        let useAR = document.getElementById('arToggle').checked;

        let final = text;

        // æ¨¡æ¿æ›¿æ¢é€»è¾‘
        if (presetIdx !== "none") {
            let template = PRESETS_DB[presetIdx].content;
            if (template.includes("{prompt}")) {
                // å¦‚æœæœ‰å ä½ç¬¦ï¼Œæ›¿æ¢å®ƒ
                final = template.replace("{prompt}", text);
            } else {
                // å¦‚æœæ²¡æœ‰å ä½ç¬¦ï¼Œç›´æ¥è¿½åŠ 
                final = template + ", " + text;
            }
        }

        // è¿½åŠ ç”»è´¨è¯
        if (useQuality && final) final += QUALITY_TAGS;
        
        // è¿½åŠ æ¯”ä¾‹
        if (useAR && final) final += " --ar 16:9";

        document.getElementById('finalOutput').innerText = final || "ç­‰å¾…è¾“å…¥...";
    }

    // å¤åˆ¶åŠŸèƒ½
    function copyPrompt() {
        const text = document.getElementById('finalOutput').innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert("âœ… å·²å¤åˆ¶ï¼è¯·åˆ‡æ¢åº”ç”¨ã€‚");
            // å°è¯• Android Intent è·³è½¬ (è§†ç³»ç»Ÿå…¼å®¹æ€§è€Œå®š)
            // window.location.href = "intent://#Intent;scheme=googleapp;package=com.google.android.apps.bard;end";
        }).catch(err => {
            alert("âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é•¿æŒ‰æ–‡æœ¬æ¡†å¤åˆ¶ã€‚");
        });
    }
</script>
</body>
</html>
